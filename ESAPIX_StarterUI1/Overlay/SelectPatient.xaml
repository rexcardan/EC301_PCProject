<Page x:Class="ESAPIX.AppKit.Overlay.SelectPatient"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml">
    <Grid x:Name="selGrid">
        <Border Padding="10">
            <StackPanel MinWidth="600" Spacing="8">
                <!-- Header with Theme Toggle -->
                <DockPanel>
                    <TextBlock Text="ESAPIX Patient Selector" FontWeight="Bold" FontSize="16" DockPanel.Dock="Left" VerticalAlignment="Center" />
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                        <TextBlock Text="Theme" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ui:ToggleSwitch x:Name="ThemeSwitch"
                                         OffContent="Light"
                                         OnContent="Dark"
                                         Toggled="ThemeSwitch_Toggled" />
                    </StackPanel>
                </DockPanel>

                <!-- Show Button -->
                <ui:Button x:Name="showContextButton"
                           Content="Change Patient Context"
                           Appearance="Secondary"
                           Click="ShowPatientContext_Click" />

                <!-- Patient Context Menu -->
                <StackPanel x:Name="patientContextMenu" Spacing="6">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="6">
                        <TextBlock Text="Patient Id" VerticalAlignment="Center" />
                        <ComboBox IsEditable="True" x:Name="patientId" Width="280"
                                  ItemsSource="{Binding Suggestions}"
                                  DisplayMemberPath="Display"
                                  IsTextSearchEnabled="False"
                                  SelectedValuePath="Summary"
                                  PreviewTextInput="patientId_PreviewTextInput"
                                  PreviewKeyDown="patientId_PreviewKeyDown"
                                  DropDownClosed="patientId_DropDownClosed" />
                        <ComboBox ItemsSource="{Binding Courses}" Width="160"
                                  ToolTip="Course"
                                  SelectedItem="{Binding SelectedCourse, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Padding="2" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <ComboBox ItemsSource="{Binding PlanItems}" Width="160"
                                  ToolTip="Plan"
                                  SelectedItem="{Binding SelectedPlanItem, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Padding="2" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <ui:Button Margin="5,0,0,0" Padding="10,6" Command="{Binding SaveContextCommand}">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="Save24" />
                            </ui:Button.Icon>
                            Save
                        </ui:Button>
                    </StackPanel>

                    <!-- Status Bar -->
                    <ui:Card Padding="6">
                        <TextBlock Text="{Binding Status}" HorizontalAlignment="Center"/>
                    </ui:Card>
                </StackPanel>

                <!-- Hide Button -->
                <ui:Button x:Name="hideContextButton" Content="↑ Hide Patient Context Menu" Click="HidePatientContext_Click" />
            </StackPanel>
        </Border>
    </Grid>
</Page>
