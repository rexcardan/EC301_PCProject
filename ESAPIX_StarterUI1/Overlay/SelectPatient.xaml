<Page x:Class="ESAPIX.AppKit.Overlay.SelectPatient"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml">
    <Grid x:Name="selGrid">
        <Border Padding="10">
            <StackPanel MinWidth="600">
                <!-- Header with Theme Toggle -->
                <DockPanel Margin="0,0,0,8">
                    <TextBlock Text="ESAPIX Patient Selector"
                               HorizontalAlignment="Center"
                               FontWeight="Bold" FontSize="16" DockPanel.Dock="Top" VerticalAlignment="Center" />
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                        <TextBlock Text="Theme" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ui:ToggleSwitch x:Name="ThemeSwitch"
                                         OffContent="Light"
                                         OnContent="Dark"
                                         Checked="ThemeSwitch_Checked"
                                         Unchecked="ThemeSwitch_Checked" />
                    </StackPanel>
                </DockPanel>

                <!-- Show Button -->
                <ui:Button x:Name="showContextButton"
                           Content="Change Patient Context"
                           Appearance="Secondary"
                           Click="ShowPatientContext_Click" Margin="0,0,0,8" />

                <!-- Patient Context Menu -->
                <StackPanel x:Name="patientContextMenu">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,6">
                        <TextBlock Text="Patient Id" VerticalAlignment="Center" />
                        <ComboBox IsEditable="True" x:Name="patientId" Width="280" Margin="6,0,0,0"
                                  ItemsSource="{Binding Suggestions}"
                                  DisplayMemberPath="Display"
                                  IsTextSearchEnabled="False"
                                  SelectedValuePath="Summary"
                                  PreviewTextInput="patientId_PreviewTextInput"
                                  PreviewKeyDown="patientId_PreviewKeyDown"
                                  DropDownClosed="patientId_DropDownClosed" />
                        <ComboBox ItemsSource="{Binding Courses}" Width="160" Margin="6,0,0,0"
                                  ToolTip="Course"
                                  SelectedItem="{Binding SelectedCourse, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Padding="2" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <ComboBox ItemsSource="{Binding PlanItems}" Width="160" Margin="6,0,0,0"
                                  ToolTip="Plan"
                                  SelectedItem="{Binding SelectedPlanItem, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Padding="2" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <ui:Button Margin="6,0,0,0" Padding="10,6" Command="{Binding SaveContextCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/ESAPIX WPF Example;component/Resources/save.png" Width="16" Height="16" Margin="0,0,6,0" />
                                <TextBlock Text="Save" VerticalAlignment="Center" />
                            </StackPanel>
                        </ui:Button>
                        <ui:Button Margin="6,0,0,0" Padding="10,6" Command="{Binding LoadContextCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/ESAPIX WPF Example;component/Resources/browser.png" Width="16" Height="16" Margin="0,0,6,0" />
                                <TextBlock Text="Load Context" VerticalAlignment="Center" />
                            </StackPanel>
                        </ui:Button>
                        <ui:Button Margin="6,0,0,0" Padding="10,6" Command="{Binding HistoryContextCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/ESAPIX WPF Example;component/Resources/history.png" Width="16" Height="16" Margin="0,0,6,0" />
                                <TextBlock Text="History" VerticalAlignment="Center" />
                            </StackPanel>
                        </ui:Button>
                    </StackPanel>

                    <!-- Status Bar -->
                    <ui:Card Padding="6" Margin="0,0,0,6">
                        <TextBlock Text="{Binding Status}" HorizontalAlignment="Center"/>
                    </ui:Card>
                </StackPanel>

                <!-- Hide Button -->
                <ui:Button x:Name="hideContextButton" Content="↑ Hide Patient Context Menu" Click="HidePatientContext_Click" />
            </StackPanel>
        </Border>
    </Grid>
</Page>
